<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Bauer stereophonic-to-binaural DSP</title>
  <meta content="Boris Mikhaylov" name="author">
  <meta http-equiv="Content-Type"
 content="text/html; charset=windows-1251">
</head>
<body style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);"
 alink="#000099" link="#000099" vlink="#990099">
<table
 style="width: 700px; text-align: left; font-family: times new roman,times,serif;"
 border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;"><big><big><span
 style="font-weight: bold;">Bauer stereophonic-to-binaural DSP.</span></big></big><br>
      <big><span style="font-weight: bold;"><br>
      <a name="Preface"></a>1.
Предисловие.</span></big><br>
      <br>
Обычная стерео запись производится для прослушивания
громкоговорителями. Это означает, что звукорежиссер делает стерео
микширование с адаптацией звука для прослушивания одного канала обеими
ушами. Следовательно, вы будете утомлены при длительном прослушивании в
наушниках больше из-за суперстерео эффекта чем из-за плохой конструкции
наушников. В наушниках отсутствует то, что звук идет от каждого канала
к противоположному уху,
достигает его через некоторое короткое время проходя дополнительное
расстояние, и с частично ослабленными верхними частотами из-зи эффекта
тени головы.
И задержка до дальнего уха несколько больше на низких частотах чем на
высоких. Bauer stereophonic-to-binaural DSP (<a
 href="http://bs2b.sourceforge.net/" target="_top">bs2b</a>)
предназначен для улучшения прослушивания аудио стерео программ в
наушниках. Это улучшение хорошо было объяснено дизайнерами электронных
схем такими как
Benjamin Bauer <a href="#r1">[1]</a>, Siegfried Linkwitz <a href="#r2">[2]</a>,
Chu Moy <a href="#r3">[3]</a>, Jan Meier <a href="#r4">[4]</a>, John
Conover <a href="#r10">[10]</a>,
HeadRoom <a href="#r9">[9]</a>.
Задержка в низкочастотном диапазоне, фильтры высокой частоты (ФВЧ),
фильтры ослабления низкой частоты (ФОНЧ), и взаимосмешение в их
электронных схемах сделаны на аналоговых RL
(Bauer) или RC
(Linkwitz, Moy, Meier) фильтрах перврго порядка. Такой дизайн
производит желаемые эффекты и естественно исключает эффект гребенчатого
фильтра в верхнем диапазоне частот благодаря нелинейному свойству
фазово-частотной характеристики (ФЧХ) этих фильтров. bs2b делает такую
же работу посредством простых и быстрых (в сревнение со сверткой)
однополярных рекурсивных цифровых фильтров, потому что эти фильтры
имеют такие же свойства как электронный RC-фильтры <a href="#r5">[5]</a>,
      <a href="#r6">[6]</a>, <a href="#r7">[7]</a>.
Я выбрал такие значения частот среза для ФВЧ и ФОНЧ которые позволяют
получать желательные задержку и наиболее ровную результирующую
амплитудно-частотную характеристику (АЧХ). К сожалению, я не вычислил
реальное значение частоты среза ФОНЧ, но это не так важно. ФОНЧ
цифровой фильтр может быть представлен как двойной фильтр: как
вычитание ослабленного профильтрованного ФВЧ сигнала из оригинального
сигнала.
Это может быть математически приведено к одношаговому рекурсивному
фильтру. В первом релизе (1.0.0) bs2b я применял двушаговый метод для
ФОНЧ с использованием уже полученного ФВЧ сигнала, но это делает
значение частоты среза ФОНЧ немного меньше чем я предполагал, и это
ведет к выделению низко-средних частот. Тем не менее, как написал Chu
Moy <a href="#r3">[3]</a>, значение частоты среза ФОНЧ должно быть
немного больше чем это значение для ФВЧ для достижения более гладкой
АЧХ кросфидера. Поэтому, я сделал одношаговый метод для ФОНЧ во втором
релизе bs2b. Я начал этот проект потому что звук других, которые я
слушал до этого, наушниковых плагинов для аудиоплееров не удовлетворил
меня. Основновное ухудшение звука наушниковыми DSP производится
эффектом гребенчатого фильтра из-за использования FFT свертки с
линейной ФЧХ для фильтрации. Есть плагин <a
 href="http://www.stereo-balance.net/" target="_top">HeadPlug</a>
который имеет опцию 'decomb', и автор пишет об этом: "The way the
plugin does
this is
really damn-ass straight-forward from a technical point of view". Я
попытался сделать это намного легче для CPU. Последнее замечание. bs2b
не производит симуляцию какого либо окружения и не производит какую
либо HRTF <a href="#r8">[8]</a> трансформацию в высокочастотном
диапазоне. Некоторое применение HRTF в высокочастотном диапазоне уже
сделано наушниками, исключая бинауральные наушники такие как <a
 href="http://www.etymotic.com/" target="_top">Etymotic</a> ER-4B.<br>
Итак, пробуйте использовать bs2b чтобы почуствовать звук немного вне
вашей головы для облегчения работы вашего мозга.<br>
      <br>
      <big><span style="font-weight: bold;"><a name="Theoretical_issue"></a>2.
Теория.</span></big><br>
      <br>
Однополюсный рекурсивный фильтр представляется рекурсивным выражением:<br>
O[n] = a0 * I[n] + a1 * I[n-1] + b1 * O[n-1]<br>
где a0, a1, b1 - рекурсионные коэффициенты, I[n] - входящие значения
сэмплов,
O[n] - результирующие (фильтрованные) значения сэмплов. Характеристики
фильтров зависят от рекурсионных коэффициентов. Таблица 2.1 показывает
perl программу которая вычисляет частотную и временную зависимости bs2b
с помощью H-преобразования <a href="bs2b.html#r5">[5]</a>.<br>
      <br>
      <span style="font-weight: bold;">Table 2.1. bs2b-H-transform.pl.</span><br>
      <table
 style="width: 100%; background-color: rgb(255, 255, 204); text-align: left; font-family: courier new,courier,monospace;"
 border="0" cellpadding="2" cellspacing="2">
        <tbody>
          <tr>
            <td style="vertical-align: top;"><font size="-1">#!/usr/bin/perl<br>
            <br>
use Math::Complex;<br>
            <br>
$s&nbsp;&nbsp;&nbsp; = 40000; # Sample rate (Hz)<br>
            <br>
$Fc&nbsp;&nbsp; = shift; # Lowpass filter cut frequency (Hz)<br>
$Gd&nbsp;&nbsp; = shift; # Lowpass filter gain (dB)<br>
$Ad_h = shift; # Highboost filter gain (dB) (0dB is highs)<br>
            <br>
# example:<br>
# perl bs2b-H-transform.pl 700 -8 -2<br>
# it makes -6 dB crossfeed level<br>
#<br>
            </font><font size="-1"># bs2b 2.0.0b uses data listed below.<br>
# perl bs2b-H-transform.pl 700 -5.5&nbsp; -2.5&nbsp; # high crossfeed
level<br>
# perl bs2b-H-transform.pl 500 -6.75 -2.25 # middle crossfeed level<br>
# perl bs2b-H-transform.pl 360 -8&nbsp;&nbsp;&nbsp;
-2&nbsp;&nbsp;&nbsp; # low crossfeed level<br>
            </font><font size="-1"># bs2b 2.1.0 uses additional 'Easy'
data that below.</font><br>
            <font size="-1"># perl bs2b-H-transform.pl 700 -8
-2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </font><font size="-1"># high
easy crossfeed
level</font><br>
            <font size="-1"># perl bs2b-H-transform.pl 500 -9 -1.8</font><font
 size="-1">&nbsp;&nbsp;&nbsp;&nbsp; # middle</font><font size="-1"> easy</font><font
 size="-1"> crossfeed level</font><br>
            <font size="-1"># perl bs2b-H-transform.pl 360 -10 -1.6</font><font
 size="-1">&nbsp;&nbsp;&nbsp; # low</font><font size="-1"> easy</font><font
 size="-1"> crossfeed level</font><br>
            <font size="-1"><br>
            </font><br>
            <font size="-1">$G&nbsp;&nbsp;&nbsp; = 10 ** ($Gd / 20);<br>
$A_h&nbsp; = 10 ** ($Ad_h / 20);<br>
$G_h&nbsp; = 1 - $A_h;<br>
            <br>
$Gd_h = 20 * log($G_h) / log(10);<br>
$Fc_h = $Fc * (2 ** (($Gd - $Gd_h) / 12)); # '/3' by my theory, but...<br>
            <br>
print "Fc_low = $Fc\nFc_high = $Fc_h\n";<br>
print "G = $G\nG_h = $G_h\n";<br>
            <br>
$fc&nbsp;&nbsp; = $Fc / $s;<br>
$d&nbsp;&nbsp;&nbsp; = 1 / 2 / pi / $fc;<br>
$x&nbsp;&nbsp;&nbsp; = exp(-1 / $d);<br>
            <br>
$fc_h = $Fc_h / $s;<br>
$d_h&nbsp; = 1 / 2 / pi / $fc_h;<br>
$x_h&nbsp; = exp(-1 / $d_h);<br>
            <br>
# Lowpass single pole filter coefficients<br>
$b1&nbsp;&nbsp; = $x;<br>
$a0&nbsp;&nbsp; = $G * (1 - $x);<br>
$a1&nbsp;&nbsp; = 0;<br>
            <br>
# Highboost single pole filter coefficients<br>
$b1_h = $x_h;<br>
$a0_h = 1 - $G_h * (1 - $x_h);<br>
$a1_h = -$x_h;<br>
            <br>
$w0 = 2 * pi * 4 / $s / 1.15;<br>
$z = exp(i * $w0);<br>
$H0&nbsp;&nbsp; = ($a0&nbsp;&nbsp; + $a1&nbsp;&nbsp; / $z) / (1 -
$b1&nbsp;&nbsp; / $z);<br>
$H0_h = ($a0_h + $a1_h / $z) / (1 - $b1_h / $z);<br>
            <br>
for ($w = $w0 * 1.15; $w &lt;= pi/2; $w0 = $w, $w *= 1.15)<br>
{<br>
&nbsp;&nbsp;&nbsp; $z = exp(i * $w);<br>
&nbsp;&nbsp;&nbsp; $H&nbsp;&nbsp; = ($a0&nbsp;&nbsp; + $a1&nbsp;&nbsp;
/ $z) / (1 - $b1&nbsp;&nbsp; / $z);<br>
&nbsp;&nbsp;&nbsp; $H_h = ($a0_h + $a1_h / $z) / (1 - $b1_h / $z);<br>
            <br>
&nbsp;&nbsp;&nbsp; $str = sprintf("%f\t%f\t%f\t%f\t%f\t%f\t%f\n",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $s * $w / 2 / pi,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rho($H),&nbsp;&nbsp;&nbsp; #
20 * log(rho($H)) / log(10) (dB)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; theta($H) * 180 /
pi,&nbsp;&nbsp;&nbsp; # degree<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (theta($H) - theta($H0)) /
($w - $w0) * 1000000 / $s,&nbsp;&nbsp;&nbsp;&nbsp; # mcs<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rho($H_h),&nbsp; # 20 *
log(rho($H_h)) / log(10)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; theta($H_h) * 180 /
pi,&nbsp; # degree<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (theta($H_h) - theta($H0_h))
/ ($w - $w0) * 1000000 / $s&nbsp; # mcs<br>
&nbsp;&nbsp;&nbsp; );<br>
            <br>
&nbsp;&nbsp;&nbsp; $str =~ s/\./\,/g; # Russian locale<br>
&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp; print $str;<br>
            <br>
&nbsp;&nbsp;&nbsp; $H0&nbsp;&nbsp; = $H;<br>
&nbsp;&nbsp;&nbsp; $H0_h = $H_h;<br>
}<br>
            </font> </td>
          </tr>
        </tbody>
      </table>
      <br>
Рисунки 2.1 и 2.2 показывают результаты выше указанной программы.
Другими словами,
это тереотические зависимости bs2b DSP. Показаны только установки bs2b
низкого (low) уровня взаимосмешения '-L' и высокого (high) уровня
взаимосмешения '-H'. Средняя установка (middle) уровня взаимосмешения
опущена для наглядности. 'HB' означает ФОНЧ (highboost
filter). 'LP' означает ФВЧ (lowpass filter). 'M' означает сумму этих
отфильтрованных сигналов,
которая может быть интерпретирована как bs2b действие на двухканальный
моно сигнал.<br>
      <br>
      <span style="font-weight: bold;">Рисунок</span><span
 style="font-weight: bold;"></span><span style="font-weight: bold;">
2.1. bs2b </span><span style="font-weight: bold;">теоретическая
частотная характеристика</span><span style="font-weight: bold;">.</span><br>
      <img alt="bs2b theoretical frequency response"
 src="img/bs2b_h-trans_f.png" style="width: 679px; height: 489px;"><br>
      <br>
На рисунке 2.2 отрицательное время представляет задержку сигнала в
микросекундах.<br>
      <br>
      <span style="font-weight: bold;">Рисунок</span><span
 style="font-weight: bold;"> 2.2. bs2b </span><span
 style="font-weight: bold;">теоретическая</span><span
 style="font-weight: bold;"> </span><span style="font-weight: bold;">временная
      </span><span style="font-weight: bold;">характеристика</span><span
 style="font-weight: bold;">.</span><br>
      <img alt="bs2b theoretical time delay response"
 src="img/bs2b_h-trans_d.png" style="width: 680px; height: 293px;"><br>
      <br>
Эти характеристики выглядят так как если бы виртуальные стерео
громкоговорители переместились от 30
градусов (high crossfeed level) до 60 градусов (low crossfeed
level) по азимуту.<br>
      <br>
Рисунки 2.3 и 2.4 показывают результаты выше указанной программы для
новых 'Easy'
уровней взаимосмешения выпуска 2.1 bs2b. Показаны только установки
low-easy уровня смешения
'-L' и high-easy уровня смешения '-H'.<br>
      <br>
      <span style="font-weight: bold;">Рисунок</span><span
 style="font-weight: bold;"> 2.3. bs2b </span><span
 style="font-weight: bold;">теоретическая частотная характеристика</span><span
 style="font-weight: bold;">. 'Easy' версия.</span><br>
      <img alt="bs2b theoretical frequency response. 'Easy' version"
 src="img/bs2b_h_e-trans_f.png" style="width: 679px; height: 489px;"><br>
      <br>
High-easy установка схожа с Chu Moy <a href="bs2b.html#r3">[3]</a>
версией кроссфидера.<br>
Рисунок 2.4 представляет характеристику временной задержки 'Easy'
версии.<br>
      <br>
      <span style="font-weight: bold;">Рисунок 2.4. bs2b теоретическая </span><span
 style="font-weight: bold;">временная </span><span
 style="font-weight: bold;">характеристика. 'Easy' версия.</span><br>
      <img alt="bs2b theoretical time delay response. 'Easy' version"
 src="img/bs2b_h_e-trans_d.png" style="width: 680px; height: 293px;"><br>
      <br>
Эти характеристики выглядят похожими на 'нелегкую' версию из-за
одинакового набора частот среза для ФВЧ и малого различия в наборе
частот среза для ФОНЧ для обеих версий.<br>
      <br>
      <big><span style="font-weight: bold;"><a name="Practical_data"></a>3.
Эксперимент.<br>
      </span></big><br>
Рисунок 3.1 показывает практические частотные характеристики bs2b. Это
частотный анализ пропущенного через
bs2b сигнала белого шума. Три вида белого шума: двухканальный моно
сигнал 'M', двухканальный независимый сигнал 'I' и одноканальный
сигнал. Обработка посредством bs2b одноканального сигнала
представляется как характеристика ФОНЧ 'HB' или канал с первичным
сигналом и как
характеристика ФВЧ 'LP' или канал без первичного сигналаl. Показаны
только установки bs2b низкого уровня '-L' и высокого уровня '-H'
смешивания. Установка среднего уровня смешивания опущена для
наглядности.<br>
      <br>
      <span style="font-weight: bold;">Рисунок 3.1. bs2b </span><span
 style="font-weight: bold;">частотная характеристика</span><span
 style="font-weight: bold;">.</span><br>
      <img alt="bs2b frequency response" src="img/bs2b_exdata_f.png"
 style="width: 678px; height: 488px;"><br>
      <br>
Рисунок 3.2 показывает разницу между частотным анализом реальной аудио
программы и частотным анализом этой программы обработанной bs2b.<br>
      <br>
      <span style="font-weight: bold;">Рисунок 3.2. J.S. Bach
"BWV1066"
"Overture" </span><span style="font-weight: bold;">разница частотного
анализа</span><span style="font-weight: bold;"></span><span
 style="font-weight: bold;">.</span><br>
      <img
 alt="J.S. Bach &quot;BWV1066&quot; &quot;Overture&quot; frequency analysis difference"
 src="img/Bach-BWV1066-Overture-diff.png"
 style="width: 681px; height: 294px;"><br>
      <br>
Рисунок 3.3 показывает практические частотные характеристики bs2b c
установкой 'Easy High'.<br>
      <br>
      <span style="font-weight: bold;">Рисунок 3.3. bs2b частотная
характеристика</span><span style="font-weight: bold;">. 'Easy' версия</span><span
 style="font-weight: bold;">.</span><br>
      <img alt="bs2b frequency response. 'Easy' version"
 src="img/bs2b_e_exdata_f.png" style="width: 678px; height: 488px;"><br>
      <br>
Рисунок 3.4 как рисунок 3.2 но для 'Easy High' ('-H') и 'Easy
Low' ('-L') установок.<br>
      <br>
      <span style="font-weight: bold;">Рисунок 3.4. J.S. Bach
"BWV1066"
"Overture" разница частотного анализа</span><span
 style="font-weight: bold;">. 'Easy' версия</span><span
 style="font-weight: bold;">.</span><br>
      <img
 alt="J.S. Bach &quot;BWV1066&quot; &quot;Overture&quot; frequency analysis difference. 'Easy' version"
 src="img/Bach-BWV1066-Overture-diff_e.png"
 style="width: 681px; height: 294px;"><br>
      <br>
      <br>
      <big><span style="font-weight: bold;"><a name="References"></a>4.
Ссылки.</span></big><br>
      <br>
      <a name="r1"></a>[1] &nbsp;Benjamin B. Bauer. Stereophonic
Earphones
and
Binaural Loudspeakers.<br>
      <div style="margin-left: 40px;">JAES Volume 9
Number 2 pp. 148-151; April 1961. <a href="http://www.aes.org/"
 target="_top">http://www.aes.org/</a><br>
      </div>
      <br>
      <a name="r2"></a>[2] &nbsp;Siegfried Linkwitz. Improved Headphone
Listening. Build a stereo-crossfeed circuit.<br>
      <div style="margin-left: 40px;">Audio; December 1971. <a
 href="http://www.linkwitzlab.com/" target="_top">http://www.linkwitzlab.com/</a><br>
      </div>
      <br>
      <a name="r3"></a>[3] &nbsp;Chu Moy. An Acoustic Simulator for
Headphone
Amplifiers.<br>
      <div style="margin-left: 40px;">(C) 1998-2001 Chu Moy. <a
 href="http://headwize.com/projects/showfile.php?file=cmoy1_prj.htm"
 target="_top">http://headwize.com/projects/showfile.php?file=cmoy1_prj.htm</a><br>
      </div>
      <br>
      <a name="r4"></a>[4] &nbsp;Jan Meier. A DIY Headphone Amplifier.<br>
      <div style="margin-left: 40px;"><a
 href="http://www.meier-audio.de/" target="_top">http://www.meier-audio.de/</a>, <a href="http://bs2b.sourceforge.net/ARIETTA/index.html">CORDA ARIETTA</a><br>
      </div>
      <br>
      <a name="r5"></a>[5] &nbsp;Steven W. Smith, Ph.D. The Scientist
and
Engineer's Guide to Digital Signal Processing.<br>
      <div style="margin-left: 40px;">California Technical
Publishing; ISBN 0-9660176-3-3 (1997). <a
 href="http://www.dspguide.com/" target="_top">http://www.dspguide.com/</a><br>
      </div>
      <br>
      <a name="r6"></a>[6] &nbsp;Davide Rocchesso. Introduction to
Sound
Processing.<br>
      <div style="margin-left: 40px;">(C) 2003 Davide Rocchesso, GNU
FDL. <a href="http://profs.sci.univr.it/%7Erocchess" target="_top">http://profs.sci.univr.it/~rocchess</a><br>
      </div>
      <br>
      <a name="r7"></a>[7] &nbsp;BORES Signal Processing: Introduction
to
DSP.<br>
      <div style="margin-left: 40px;">(C) 2004 Bores Signal Processing.
      <a href="http://www.bores.com/courses/intro/index.htm"
 target="_top">http://www.bores.com/courses/intro/index.htm</a><br>
      </div>
      <br>
      <a name="r8"></a>[8] &nbsp;Richard O.Duda. 3-D Audio for HCI.<br>
      <div style="margin-left: 40px;">(C)
1996-2000 Richard O.Duda. <a href="http://interface.cipic.ucdavis.edu/"
 target="_top">http://interface.cipic.ucdavis.edu/</a><br>
      </div>
      <br>
      <a name="r9"></a>[9]&nbsp; HeadRoom. About the HeadRoom
Crossfeed.<br>
      <div style="margin-left: 40px;">(C) 1995-2006 HeadRoom. <a
 href="http://www.headphone.com/products/faqs/about-headroom-crossfeed/"
 target="_top">http://www.headphone.com/products/faqs/about-headroom-crossfeed/</a><br>
      </div>
      <br>
      <a name="r10"></a>[10]&nbsp; John Conover. Spatial Distortion
Reduction Headphone Amplifier.<br>
      <div style="margin-left: 40px;">(C) 1992-2005 John Conover. <a
 href="http://www.johncon.com/john/SSheadphoneAmp/index.html"
 target="_top">http://www.johncon.com/john/SSheadphoneAmp/index.html</a><br>
      </div>
      <br>
      <hr style="width: 100%; height: 2px;">Авторское право (c)
2006&nbsp;
Борис Михайлов &lt; <a href="http://www.tmn.ru/%7Ebor" target="_top">http://www.tmn.ru/~bor</a>&gt;</td>
    </tr>
  </tbody>
</table>
</body>
</html>
